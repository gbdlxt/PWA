<!DOCTYPE html>
<html>

<head>
  <title>T PWA</title>
  <meta charset="UTF-8">
  <link rel="manifest" href="test.webmanifest">
</head>
<body>
  <h1>Custom Installation</h1>
  <div id="mark" style="display: none;">
    <button id="installBtn" style="margin: 20px;width: 100%;height: 400px;">一键安装应用</button>
  </div>
</body>
<script>
  let deferredPrompt
  // 阻止默认弹出安装事件
  window.addEventListener('beforeinstallprompt', (event) => {
    // 阻止默认行为
    event.preventDefault()
    // 保存事件，稍后触发安装
    deferredPrompt = event
    // 显示自定义安装按钮
    document.getElementById('mark').style.display = 'block'
  })

  // 监听按钮点击事件
  document.getElementById('installBtn').addEventListener('click', (e) => {
    e.preventDefault();
    if (deferredPrompt) {
      // 触发PWA安装
      deferredPrompt.prompt()

      // 监听安装结果
      deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === 'accepted') {
          console.log('用户安装了PWA')
        } else {
          console.log('用户拒绝安装PWA')
        }
        // 重置事件
        deferredPrompt = null
      })
    }
  });
</script>

</html>